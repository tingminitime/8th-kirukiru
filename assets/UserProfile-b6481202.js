var e=Object.defineProperty,t=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,s=(t,a,o)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[a]=o;import{_ as n}from"./AlertModal-87d47552.js";import{_ as r}from"./DynamicTextarea-d6641047.js";import{_ as i}from"./FormInputText-297ba79a.js";import{_ as l}from"./CoverUpload-862356d0.js";import{ao as m,m as c,r as u,o as d,c as g,d as f,e as h,t as p,s as v,u as b,w,D as y}from"./vendor-358810ac.js";import{c as x,a as I}from"./object-fe354ed4.js";import{_ as C,i as S,V as j,W as N,X as B}from"./index-77469bef.js";const $={name:"UserProfile",components:{CoverUpload:l,DynamicTextarea:r,AlertModal:n},emits:["get-info"],data(){const e=x().shape({"user-new-name":I().required()}),{value:t,errorMessage:a}=m("user-introduction",I().nullable().max(300));return{nameSchema:e,avatarImage:null,isShowNameInput:!1,userIntroduction:t,introError:a,alertInfo:null}},computed:((e,n)=>{for(var r in n||(n={}))a.call(n,r)&&s(e,r,n[r]);if(t)for(var r of t(n))o.call(n,r)&&s(e,r,n[r]);return e})({},c(["userInfo"])),mounted(){this.userIntroduction=this.userInfo.Introduction},methods:{toggleUploadCover(){this.$refs.avatarUploader.$refs.upload.$refs.input.click()},avatarChange(e){this.avatarImage=e},avatarConfirm(){this.sendAvatar(this.avatarImage.name)},avatarCancel(){this.avatarImage=null},async sendAvatar(e){const t=new FormData;t.append("photo",this.avatarImage.file);let a="";await S(t).then((t=>{t.data.success?a=t.data.picname:(this.$notify({group:"error",title:"上傳圖片失敗 !"}),this.newAvatarName="origin.jpg",this.articleVm.firstPhoto=e)})).catch((e=>{})),await j(a).then((e=>{e.data.success&&this.$notify({group:"success",title:"大頭貼修改成功"})})).catch((e=>{})),this.$emit("get-info")},toggleChangeName(){this.isShowNameInput=!this.isShowNameInput},onNameSubmit(e){N(e["user-new-name"]).then((e=>{e.data.success?(this.$notify({group:"success",title:"暱稱更新成功"}),this.$emit("get-info"),this.toggleChangeName()):this.$notify({group:"error",title:e.data.message})})).catch((e=>{}))},onNameInvalidSubmit(e){},onChangeIntro(){this.introError||(this.alertInfo={message:"是否確定更改敘述 ?",confirmMode:"nothing",messageClass:"text-lg font-bold text-myBrown md:text-xl"},this.$store.commit("SHOW_ALERT"))},changeIntroHandler(){B(this.userIntroduction).then((e=>{e.data.success?(this.$notify({group:"success",title:"敘述更新成功"}),this.$emit("get-info")):this.$notify({group:"error",title:e.data.message})})).catch((e=>{}))}}},U={class:"w-full"},P=f("h2",{class:"mb-8 text-2xl font-bold text-myBrown"}," 我的主頁 ",-1),A={class:"flex justify-between items-center border-b border-myBrown"},F={class:"flex grow items-center py-4 text-myBrown"},O=f("div",{class:"w-1/4 font-bold"}," 大頭貼 ",-1),_={class:"text-center"},E={class:"py-12 border-b border-myBrown"},V=f("div",{class:"mb-5 w-1/4 font-bold text-myBrown"}," 變更暱稱 ",-1),k={class:"flex flex-col gap-6"},D={class:"flex items-center text-myBrown"},M=f("div",{class:"w-1/4"}," 目前暱稱 ",-1),T={class:"font-semibold"},H={class:"flex gap-3 text-myBrown"},W=f("div",{class:"text-center"},[f("button",{type:"submit",class:"userPageButton"}," 確認更改 ")],-1),q={class:"text-center"},L={class:"py-12"},R=f("div",{class:"mb-5 w-1/4 font-bold text-myBrown"}," 個人主頁敘述 ",-1),X={class:"text-sm text-red-500"},Y={class:"text-right"},z=["disabled"];var G=C($,[["render",function(e,t,a,o,s,m){const c=l,x=i,I=u("v-form"),C=r,S=n;return d(),g("div",U,[P,f("div",A,[f("div",F,[O,f("div",null,[h(c,{ref:"avatarUploader",name:"avatar",class:"overflow-hidden w-[64px] rounded-full","fix-text":"修改","upload-bg":"bg-upload-cover","orig-image":e.userInfo.Userpic,"edit-mode":!0,"aspect-width":1,"aspect-height":1,"show-upload-button":!1,onFileChange:m.avatarChange,onFileConfirm:m.avatarConfirm,onFileCancel:m.avatarCancel},null,8,["orig-image","onFileChange","onFileConfirm","onFileCancel"])])]),f("div",_,[f("button",{type:"button",class:"userPageButton",onClick:t[0]||(t[0]=(...e)=>m.toggleUploadCover&&m.toggleUploadCover(...e))}," 上傳 ")])]),f("div",E,[V,f("div",k,[f("div",D,[M,f("div",null,[f("span",T,p(e.userInfo.Name),1)])]),v(h(I,{"validation-schema":s.nameSchema,onSubmit:m.onNameSubmit,onInvalidSubmit:m.onNameInvalidSubmit},{default:w((()=>[f("div",H,[h(x,{name:"user-new-name",type:"text",label:"輸入暱稱",placeholder:"輸入暱稱",class:"w-full","success-message":"","input-border":"focus:ring-2 focus:ring-myYellow"}),W])])),_:1},8,["validation-schema","onSubmit","onInvalidSubmit"]),[[b,s.isShowNameInput]]),f("div",q,[f("button",{type:"submit",class:"userPageButton",onClick:t[1]||(t[1]=(...e)=>m.toggleChangeName&&m.toggleChangeName(...e))}," 更改暱稱 ")])])]),f("div",L,[R,f("div",null,[h(C,{modelValue:s.userIntroduction,"onUpdate:modelValue":t[2]||(t[2]=e=>s.userIntroduction=e),class:"",name:"user-introduction"},null,8,["modelValue"]),f("span",X,p(s.introError),1),f("div",Y,[f("button",{type:"button",class:"userPageButton",disabled:s.introError,onClick:t[3]||(t[3]=(...e)=>m.onChangeIntro&&m.onChangeIntro(...e))}," 更改敘述 ",8,z)])])]),h(S,y(s.alertInfo,{onAlertConfirm:m.changeIntroHandler}),null,16,["onAlertConfirm"])])}]]);export{G as default};
