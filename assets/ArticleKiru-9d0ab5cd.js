var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,l=(t,s,a)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a,o=(e,t)=>{for(var s in t||(t={}))r.call(t,s)&&l(e,s,t[s]);if(a)for(var s of a(t))i.call(t,s)&&l(e,s,t[s]);return e},n=(e,a)=>t(e,s(a));/* empty css             */import{_ as c,a as d,b as u,c as m,u as h}from"./user-origin-6f43f4e2.js";import{_ as g}from"./DynamicTextarea-2d8e7f4d.js";import{_ as f,a as p}from"./KiruCardSwiper-7cd10bb9.js";import{_ as b,p as y,q as w,r as v,s as x,t as k,v as I,w as A}from"./index-36166ff4.js";import{o as M,c as S,d as V,F as L,f as j,t as P,a8 as B,l as D,s as C,a as R,a9 as T,m as O,C as H,K as $,r as K,aI as N,e as F,D as E,E as _,aw as U,h as q,w as z,x as Y}from"./vendor-c1c40a3c.js";import"./AddLove-9ac46bcb.js";import"./tippy.esm-b6ce9822.js";import"./index-3f4a165a.js";import"./pagination.min-91b3c22c.js";const G={name:"KiruMission",props:{missions:{type:Array,default:()=>[]}},methods:{missionUrlParser(e){let t;return t=/https?:\/\//.test(e)?e:`http://${e}`,t}}},W={class:"p-4 mb-12"},J=V("div",{class:"flex gap-12 justify-between mb-2"},[V("div",{class:"myArticlePartTitle myArticlePartTitleBg"},[V("h2",null,"附屬切切")]),V("div",{class:"hidden before:absolute relative before:top-1/2 grow w-1/5 before:w-full before:h-px before:bg-myBrown md:block"})],-1),Q={class:"py-8 px-12"},X={class:"grid grid-cols-1 grid-flow-row gap-4 md:grid-cols-2"},Z=["href"],ee={class:"text-myBrown line-clamp-1"},te={class:"text-sm text-gray-900 line-clamp-1"};var se=b(G,[["render",function(e,t,s,a,r,i){return M(),S("div",W,[J,V("div",Q,[V("ul",X,[(M(!0),S(L,null,j(s.missions,(e=>(M(),S("li",{key:e.fId},[V("a",{href:i.missionUrlParser(e.auxiliarymain),target:"_blank",class:"flex flex-col gap-1 justify-center p-4 border border-myBrown"},[V("span",ee,P(e.auxiliary),1),V("span",te,P(e.auxiliarymain),1)],8,Z)])))),128))])])])}]]);const ae={class:"p-4 mb-20"},re={class:"flex flex-col gap-3 border-myBrown/20 md:flex-row md:gap-0 md:border"},ie={class:"flex shrink-0 order-1 justify-start items-center w-20 md:justify-center"},le={class:"text-4xl font-bold text-myBrown md:text-5xl"},oe=["innerHTML"],ne={key:0,class:"shrink-0 order-2 w-64 h-64 border-l border-myBrown/20 md:order-3"},ce={class:"object-cover w-full h-full load",alt:""};var de=b({name:"KiruContent",props:{content:{type:Array,default:()=>[]}},computed:{}},[["render",function(e,t,s,a,r,i){const l=B("my-src");return M(),S("ul",ae,[(M(!0),S(L,null,j(s.content,((e,t)=>(M(),S("li",{key:e.mId,class:"mb-8 md:mb-4"},[V("div",re,[V("div",ie,[V("span",le,P(t+1<10?`0${t+1}`:t+1),1)]),V("div",{class:D(["flex grow order-3 items-center border-myBrown/20 md:order-2 md:px-6 md:border-l",{"py-8":"."===e.thirdPhoto}])},[V("p",{innerHTML:e.main},null,8,oe)],2),"."!==e.thirdPhoto?(M(),S("div",ne,[C(V("img",ce,null,512),[[l,{name:e.thirdPhoto,folder:"Pic"}]])])):R("",!0)])])))),128))])}]]);const ue={name:"KiruTools",props:{tools:{type:Array,default:()=>[]}}},me={class:"p-4 mb-12 md:mb-24"},he=T('<div class="mb-7"><div class="flex gap-12 justify-between mb-2"><div class="myArticlePartTitle myArticlePartTitleBg"><h2 class="whitespace-nowrap"> 預備工具 </h2></div><div class="hidden before:absolute relative before:top-1/2 grow w-2/3 before:w-full before:h-px before:bg-myBrown md:block"></div></div><p class="text-sm text-myBrown"> 此篇切切會用到的物品、工具、材料、環境...等 </p></div>',1),ge={class:"grid grid-cols-2 grid-flow-row gap-x-2 gap-y-6"},fe={key:0,class:"shrink-0 w-full border-b border-myBrown/60 aspect-w-16 aspect-h-9 md:w-1/2 md:border-r md:border-b-0 md:aspect-w-12 md:aspect-h-4"},pe={class:"object-cover absolute tools load",alt:""};var be=b(ue,[["render",function(e,t,s,a,r,i){const l=B("my-src");return M(),S("div",me,[he,V("ul",ge,[(M(!0),S(L,null,j(s.tools,(e=>(M(),S("li",{key:e.fId,class:"flex flex-col justify-between border border-myBrown/20 md:flex-row md:justify-start md:items-center"},["."!==e.secPhoto?(M(),S("div",fe,[C(V("img",pe,null,512),[[l,{name:e.secPhoto,folder:"Pic"}]])])):R("",!0),V("p",{class:D(["px-2 font-bold text-myBrown line-clamp-3",{"py-2":"."===e.secPhoto}])},P(e.mission),3)])))),128))])])}]]);const ye={name:"ArticleKiru",components:{KiruAuthor:c,KiruInfo:d,KiruTools:be,KiruContent:de,KiruMission:se,KiruCard:f,KiruCardSwiper:p,KiruReply:u,SubscribeView:m,DynamicTextarea:g},beforeRouteUpdate(e,t){e.params.articleId!==t.params.articleId&&this.$store.commit("SHOW_OVERLAY_LOADING"),this.getArticleInfo(this.articleId)},props:{articleId:{type:[String,Number],default:""},loveCount:{type:[String,Number],default:0},isAddLove:{type:Boolean,default:!1},isCollect:{type:Boolean,default:!1}},emits:["author-info","add-love","add-collection","is-add-love"],data:()=>({articleVm:{},authorInfo:{},relatedArticleVm:{nowpage:1,showcount:2},relatedArticle:[],userMessageVm:"",messagePagination:{nowpage:1,showcount:9999},messageSettings:{pageSize:5,currentPage:1,loadCount:5,total:0,topNewDate:!0},articleMessage:[],sortMessage:[],messageTotal:0,userDefaultAvatar:h,isArticleVmLoading:!1,checkSubResult:!1,isSendingMessage:!1}),computed:n(o(o({},O(["userInfo","userAddLoveList","userKiruCollections","userSubscribeList","checkUserSubscribeStatus"])),H(["userSignInStatus"])),{loadMessage(){const e=this.messageSettings;let t=[];t=e.topNewDate?[...this.articleMessage].sort(((e,t)=>$(t.messageInitDate).format("x")-$(e.messageInitDate).format("x"))):[...this.articleMessage].sort(((e,t)=>$(e.messageInitDate).format("x")-$(t.messageInitDate).format("x")));const s=(e.currentPage-1)*e.loadCount;return t.slice(0,e.pageSize+s)},showLoadMessageBtn(){return this.articleMessage.length>this.messageSettings.pageSize&&this.loadMessage.length<this.articleMessage.length},articleAuthor(){const{author:e,authorPic:t,username:s}=this.articleVm;return{author:e,authorPic:t,username:s}},articleInfo(){const{title:e,firstPhoto:t,introduction:s,articlecategoryId:a,artArtlog:r,ArtInitDate:i}=this.articleVm;return{title:e,firstPhoto:t,introduction:s,articlecategoryId:a,artArtlog:r,artInitDate:i}}}),watch:{"articleVm.articlecategoryId":{handler(e){e&&this.getRelatedArticle(e)}},userSubscribeList:{handler(){this.checkSubResult=this.checkSub(this.articleVm.username)},deep:!0}},mounted(){this.getArticleInfo(this.articleId)},methods:{checkSub(e){const t=this.userSubscribeList.some((t=>t.username===e)),s=this.$store.state.userInfo.Username===e;return t||s},async getArticleInfo(e){await y(e).then((e=>{var t;if(e.data.success){if(this.checkSub(e.data.data.username)&&(this.checkSubResult=!0),!e.data.data.isPush&&e.data.data.username!==(null==(t=this.userInfo)?void 0:t.Username))return void this.$router.replace({name:"NotFound",query:{message:"此文章尚未發布"}});this.articleVm=e.data.data,this.isArticleVmLoading=!0}else this.$router.replace({name:"NotFound",query:{message:e.data.message||"查無此文章"}})})).catch((e=>{})),await w(this.articleVm.username).then((e=>{e.data.success?(this.authorInfo=e.data.data,this.$emit("author-info",n(o({},this.authorInfo),{loveCount:this.articleVm.lovecount,isAddLove:this.isAddLove})),this.checkAddLoveStatus()):this.$notify({group:"error",title:"作者資訊取得失敗"})}));const t=o({artId:this.articleId},this.messagePagination);await v(t).then((e=>{e.data.success?(this.articleMessage=e.data.data,this.messageTotal=e.data.total||this.articleMessage.length):this.articleMessage=[]})).catch((e=>{})),this.$store.commit("HIDE_OVERLAY_LOADING")},getRelatedArticle(e){x(o({articlecategoryId:e},this.relatedArticleVm)).then((e=>{if(e.data.success){const t=e.data.data.filter((e=>Number(this.articleId)!==e.artId));this.relatedArticle=t}else this.$notify({group:"error",title:"相關文章資料取得失敗"})})).catch((e=>{}))},checkAddLoveStatus(){-1!==this.userAddLoveList.findIndex((e=>e.articleId===this.articleId))&&this.$emit("is-add-love",!0)},addLoveHandler(e){this.$emit("add-love",e)},addCollectionHandler(){this.$emit("add-collection")},async sendMessageHandler(){if(""===this.userMessageVm||this.isSendingMessage)return;this.isSendingMessage=!0;const e={artId:this.articleId,Main:this.userMessageVm};await k(e).then((e=>{this.userMessageVm="",this.isSendingMessage=!1})).catch((e=>{this.isSendingMessage=!1}));const t=o({artId:this.articleId},this.messagePagination);await v(t).then((e=>{if(e.data.success){const t=e.data.data;this.updateMessage(t),this.messageTotal=e.data.total||this.articleMessage.length}else this.$notify({group:"error",title:"留言內容取得失敗"})})).catch((e=>{}))},updateMessage(e){this.articleMessage=e},async replyHandler(e){try{await I(e).then((e=>{})).catch((e=>{}));const t=o({artId:this.articleId},this.messagePagination),s=await A(e.messageId),a=await v(t);if(s.data.success)if(a.data.success){this.updateMessage(a.data.data);const t=this.articleMessage.findIndex((t=>t.messageId===e.messageId)),r=this.articleMessage[t].reMessageData.map((e=>e.reMessageId)),i=s.data.data;i.filter((e=>-1===r.indexOf(e.reMessageId))).forEach((e=>{this.articleMessage[t].reMessageData.push(e)}))}else this.$notify({group:"error",title:"留言內容取得失敗"});else this.$notify({group:"error",title:"回覆內容取得失敗"})}catch(t){}}}},we={key:0,class:"mx-auto mb-12 max-w-[80%]"},ve={key:3},xe=T('<div class="mb-7"><div class="flex gap-12 justify-between px-4 mb-2 md:px-0"><div class="myArticlePartTitle myArticlePartTitleBg"><h2>附註<span class="hidden md:inline-block">補充</span></h2></div><div class="hidden before:absolute relative before:top-1/2 grow w-1/5 before:w-full before:h-px before:bg-myBrown md:block"></div></div></div>',1),ke={class:"px-4 mb-16 text-myBrown md:px-16"},Ie=["innerHTML"],Ae=V("div",{class:"flex gap-12 justify-center mb-4 md:justify-between"},[V("div",{class:"py-2"},[V("h2",{class:"text-2xl font-bold text-myBrown"}," 相關切切 ")])],-1),Me={class:"px-4 mb-32 md:px-0"},Se={key:0,class:"hidden grid-cols-1 grid-flow-row gap-6 md:grid md:grid-cols-2"},Ve={key:1,class:"py-2"},Le=[V("p",{class:"text-center text-myBrown/60"}," 沒有相關的切切 ",-1)],je={key:2},Pe={key:5,"element-loading-background":"rgba(0, 0, 0, 0.5)","element-loading-text":"正在送出留言...",class:"flex overflow-hidden gap-8 justify-between py-4 px-6 mb-12 rounded-lg"},Be={class:"overflow-hidden w-16 h-16 rounded-full"},De={alt:"",class:"object-cover w-full h-full scale-[102%] load"},Ce={class:"flex flex-col grow gap-3 justify-between items-end md:flex-row"},Re=[V("span",{class:"inline-block text-lg md:-translate-y-1 material-icons"},"reply",-1),V("span",{class:"text-sm whitespace-nowrap md:-translate-y-1"},"送出",-1)],Te={key:6,class:"mb-12"},Oe={class:"flex justify-center items-center py-6 bg-myYellow/20"},He=Y(" 登入後留言 "),$e={key:7,id:"article-replies",class:"mb-16"},Ke={class:"flex justify-between px-6"},Ne={class:"text-black/60"},Fe={key:0},Ee={key:1,class:"px-6"};var _e=b(ye,[["render",function(e,t,s,a,r,i){var l,o,n;const h=c,b=d,y=m,w=be,v=de,x=se,k=f,I=p,A=g,D=K("router-link"),T=u,O=B("src"),H=N;return M(),S(L,null,[F(h,E(i.articleAuthor,{"love-count":s.loveCount,"is-add-love":s.isAddLove,"replies-count":r.messageTotal,"is-collect":s.isCollect,"article-type":"kiru",onAddLove:i.addLoveHandler,onAddCollection:i.addCollectionHandler}),null,16,["love-count","is-add-love","replies-count","is-collect","onAddLove","onAddCollection"]),F(b,E({class:"p-4 mb-16 w-full"},i.articleInfo,{"show-kiru-count":!0,"kiru-count":null==(l=r.articleVm.mArrayList)?void 0:l.length}),null,16,["kiru-count"]),r.articleVm.isFree||r.checkSubResult||!r.isArticleVmLoading?R("",!0):(M(),S("div",we,[F(y,_(U(r.authorInfo)),null,16)])),0!==(null==(o=r.articleVm.fArrayList)?void 0:o.length)&&(r.articleVm.isFree||r.checkSubResult)?(M(),q(w,{key:1,tools:r.articleVm.fArrayList},null,8,["tools"])):R("",!0),r.articleVm.isFree||r.checkSubResult?(M(),q(v,{key:2,content:r.articleVm.mArrayList},null,8,["content"])):R("",!0),""!==r.articleVm.final&&(r.articleVm.isFree||r.checkSubResult)?(M(),S("div",ve,[xe,V("div",ke,[V("p",{innerHTML:r.articleVm.final},null,8,Ie)])])):R("",!0),0!==(null==(n=r.articleVm.fMissionList)?void 0:n.length)&&(r.articleVm.isFree||r.checkSubResult)?(M(),q(x,{key:4,missions:r.articleVm.fMissionList},null,8,["missions"])):R("",!0),Ae,V("div",Me,[0!==r.relatedArticle.length?(M(),S("div",Se,[(M(!0),S(L,null,j(r.relatedArticle,(e=>(M(),q(k,E(e,{key:e.artId}),null,16)))),128))])):(M(),S("div",Ve,Le)),0!==r.relatedArticle.length?(M(),S("div",je,[F(I,{key:"relative-kiru",class:"block md:hidden","kiru-info":r.relatedArticle},null,8,["kiru-info"])])):R("",!0)]),e.userSignInStatus&&(r.articleVm.isFree||r.checkSubResult)?C((M(),S("div",Pe,[V("div",Be,[C(V("img",De,null,512),[[O,e.userInfo.Userpic?"https://kirukiru.rocket-coding.com/Pic/"+e.userInfo.Userpic:r.userDefaultAvatar]])]),V("div",Ce,[F(A,{modelValue:r.userMessageVm,"onUpdate:modelValue":t[0]||(t[0]=e=>r.userMessageVm=e),modelModifiers:{trim:!0},class:"w-full h-full",placeholder:"我要留言",onEnterExact:i.sendMessageHandler},null,8,["modelValue","onEnterExact"]),V("button",{type:"button",class:"flex gap-1 justify-center items-center py-1 px-4 text-white bg-myBrown md:flex-col md:py-0 md:px-2 md:h-full md:transition-all",onClick:t[1]||(t[1]=(...e)=>i.sendMessageHandler&&i.sendMessageHandler(...e))},Re)])])),[[H,r.isSendingMessage]]):R("",!0),e.userSignInStatus||!r.articleVm.isFree&&!r.checkSubResult?R("",!0):(M(),S("div",Te,[V("div",Oe,[F(D,{class:"block text-myBrown underline decoration-myBrown/60 underline-offset-4 transition-all",to:{name:"SignIn"}},{default:z((()=>[He])),_:1})])])),r.articleVm.isFree||r.checkSubResult?(M(),S("div",$e,[V("div",Ke,[V("span",Ne,"此文共有 "+P(r.messageTotal)+" 筆留言",1),V("button",{type:"button",class:"text-sm text-myBrown/40 hover:text-myBrown/60",onClick:t[2]||(t[2]=e=>r.messageSettings.topNewDate=!r.messageSettings.topNewDate)},P(r.messageSettings.topNewDate?"留言時間 新 → 舊":"留言時間 舊 → 新"),1)]),0!==r.articleMessage.length?(M(),S("ul",Fe,[(M(!0),S(L,null,j(i.loadMessage,(e=>(M(),q(T,E(e,{key:e.messageId,"article-username":r.articleVm.username,onReplyInner:i.replyHandler}),null,16,["article-username","onReplyInner"])))),128))])):R("",!0),i.showLoadMessageBtn?(M(),S("div",Ee,[V("button",{type:"button",class:"block py-4 mx-auto w-1/2 text-sm text-myBrown bg-myOrange/20 hover:bg-myOrange/40 rounded-xl transition-all",onClick:t[3]||(t[3]=e=>r.messageSettings.currentPage+=1)}," 查看更多留言 ("+P(r.articleMessage.length-i.loadMessage.length)+") ",1)])):R("",!0)])):R("",!0)],64)}]]);export{_e as default};
